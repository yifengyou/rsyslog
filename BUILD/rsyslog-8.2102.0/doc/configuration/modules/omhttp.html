
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>omhttp: HTTP Output Module &#8212; rsyslog 8.2102.0 documentation</title>
    <link rel="stylesheet" href="../../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/rsyslog.css" />
    
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/language_data.js"></script>
    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="omhttpfs: Hadoop HTTPFS Output Module" href="omhttpfs.html" />
    <link rel="prev" title="omhiredis: Redis Output Module" href="omhiredis.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="omhttpfs.html" title="omhttpfs: Hadoop HTTPFS Output Module"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="omhiredis.html" title="omhiredis: Redis Output Module"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">rsyslog 8.2102.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Configuration</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" >Modules</a> &#187;</li>
          <li class="nav-item nav-item-3"><a href="idx_output.html" accesskey="U">Output Modules</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="omhttp-http-output-module">
<h1>omhttp: HTTP Output Module<a class="headerlink" href="#omhttp-http-output-module" title="Permalink to this headline">¶</a></h1>
<table border="1" class="docutils">
<colgroup>
<col width="26%" />
<col width="74%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><strong>Module Name:</strong></td>
<td><strong>omhttp</strong></td>
</tr>
<tr class="row-even"><td><strong>Module Type:</strong></td>
<td><strong>contributed</strong> - not maintained by rsyslog core team</td>
</tr>
<tr class="row-odd"><td><strong>Current Maintainer:</strong></td>
<td><a class="reference external" href="https://github.com/gintrator/">Gabriel Intrator</a></td>
</tr>
<tr class="row-even"><td>Original Author:</td>
<td><a class="reference external" href="https://github.com/ctramnitz/">Christian Tramnitz</a></td>
</tr>
</tbody>
</table>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">This page is incomplete, if you want to contribute you can do this on
github in the <a class="reference external" href="https://github.com/rsyslog/rsyslog-doc">rsyslog-doc repository</a>.</p>
</div>
<div class="section" id="purpose">
<h2>Purpose<a class="headerlink" href="#purpose" title="Permalink to this headline">¶</a></h2>
<p>This module provides the ability to send messages over an HTTP REST interface.</p>
<p>This module supports sending messages in individual requests (the default), and batching multiple messages into a single request. Support for retrying failed requests is available in both modes. GZIP compression is configurable with the <a class="reference internal" href="#compress">compress</a> parameter. TLS encryption is configurable with the <a class="reference internal" href="#usehttps">useHttps</a> parameter and associated tls parameters.</p>
<p>In the default mode, every message is sent in its own HTTP request and it is a drop-in replacement for any other output module. In <a class="reference internal" href="#batch">batch</a> mode, the module implements several batch formatting options that are configurable via the <a class="reference internal" href="#batch-format">batch.format</a> parameter. Some additional attention to message formatting and <a class="reference internal" href="#retry">retry</a> strategy is required in this mode.</p>
<p>See the <a class="reference internal" href="#examples">Examples</a> section for some configuration examples.</p>
</div>
<div class="section" id="notable-features">
<h2>Notable Features<a class="headerlink" href="#notable-features" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><a class="reference internal" href="#statistic-counter">Statistic Counter</a></li>
<li><dl class="first docutils">
<dt><a class="reference internal" href="#message-batching">Message Batching</a>, supports several formats.</dt>
<dd><ul class="first last">
<li>Newline concatenation, like the Elasticsearch bulk format.</li>
<li>JSON Array as a generic batching strategy.</li>
<li>Kafka REST Proxy format, to support sending data through the <a class="reference external" href="https://docs.confluent.io/current/kafka-rest/docs/index.html">Confluent Kafka REST API</a> to a Kafka cluster.</li>
</ul>
</dd>
</dl>
</li>
</ul>
</div>
<div class="section" id="configuration-parameters">
<h2>Configuration Parameters<a class="headerlink" href="#configuration-parameters" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Parameter names are case-insensitive.</p>
</div>
<div class="section" id="action-parameters">
<h3>Action Parameters<a class="headerlink" href="#action-parameters" title="Permalink to this headline">¶</a></h3>
<div class="section" id="server">
<h4>Server<a class="headerlink" href="#server" title="Permalink to this headline">¶</a></h4>
<table border="1" class="colwidths-auto parameter-table docutils">
<thead valign="bottom">
<tr class="row-odd"><th class="head">type</th>
<th class="head">default</th>
<th class="head">mandatory</th>
<th class="head"><code class="docutils literal notranslate"><span class="pre">obsolete</span> <span class="pre">legacy</span></code> directive</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>array</td>
<td>localhost</td>
<td>no</td>
<td>none</td>
</tr>
</tbody>
</table>
<p>The server address you want to connect to.</p>
</div>
<div class="section" id="serverport">
<h4>Serverport<a class="headerlink" href="#serverport" title="Permalink to this headline">¶</a></h4>
<table border="1" class="colwidths-auto parameter-table docutils">
<thead valign="bottom">
<tr class="row-odd"><th class="head">type</th>
<th class="head">default</th>
<th class="head">mandatory</th>
<th class="head"><code class="docutils literal notranslate"><span class="pre">obsolete</span> <span class="pre">legacy</span></code> directive</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>integer</td>
<td>443</td>
<td>no</td>
<td>none</td>
</tr>
</tbody>
</table>
<p>The port you want to connect to.</p>
</div>
<div class="section" id="healthchecktimeout">
<h4>healthchecktimeout<a class="headerlink" href="#healthchecktimeout" title="Permalink to this headline">¶</a></h4>
<table border="1" class="colwidths-auto parameter-table docutils">
<thead valign="bottom">
<tr class="row-odd"><th class="head">type</th>
<th class="head">default</th>
<th class="head">mandatory</th>
<th class="head"><code class="docutils literal notranslate"><span class="pre">obsolete</span> <span class="pre">legacy</span></code> directive</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>integer</td>
<td>3500</td>
<td>no</td>
<td>none</td>
</tr>
</tbody>
</table>
<p>The time after which the health check will time out in milliseconds.</p>
</div>
<div class="section" id="httpcontenttype">
<h4>httpcontenttype<a class="headerlink" href="#httpcontenttype" title="Permalink to this headline">¶</a></h4>
<table border="1" class="colwidths-auto parameter-table docutils">
<thead valign="bottom">
<tr class="row-odd"><th class="head">type</th>
<th class="head">default</th>
<th class="head">mandatory</th>
<th class="head"><code class="docutils literal notranslate"><span class="pre">obsolete</span> <span class="pre">legacy</span></code> directive</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>word</td>
<td>application/json; charset=utf-8</td>
<td>no</td>
<td>none</td>
</tr>
</tbody>
</table>
<p>The HTTP “Content-Type” header sent with each request. This parameter will override other defaults. If a batching mode is specified, the correct content type is automatically configured. The “Content-Type” header can also be configured using the <a class="reference internal" href="#httpheaders">httpheaders</a> parameter, it should be configured in only one of the parameters.</p>
</div>
<div class="section" id="httpheaderkey">
<h4>httpheaderkey<a class="headerlink" href="#httpheaderkey" title="Permalink to this headline">¶</a></h4>
<table border="1" class="colwidths-auto parameter-table docutils">
<thead valign="bottom">
<tr class="row-odd"><th class="head">type</th>
<th class="head">default</th>
<th class="head">mandatory</th>
<th class="head"><code class="docutils literal notranslate"><span class="pre">obsolete</span> <span class="pre">legacy</span></code> directive</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>word</td>
<td>none</td>
<td>no</td>
<td>none</td>
</tr>
</tbody>
</table>
<p>The header key. Currently only a single additional header/key pair is configurable, to specify multiple headers see the <a class="reference internal" href="#httpheaders">httpheaders</a> parameter. This parameter along with <a class="reference internal" href="#httpheadervalue">httpheadervalue</a> may be deprecated in the future.</p>
</div>
<div class="section" id="httpheadervalue">
<h4>httpheadervalue<a class="headerlink" href="#httpheadervalue" title="Permalink to this headline">¶</a></h4>
<table border="1" class="colwidths-auto parameter-table docutils">
<thead valign="bottom">
<tr class="row-odd"><th class="head">type</th>
<th class="head">default</th>
<th class="head">mandatory</th>
<th class="head"><code class="docutils literal notranslate"><span class="pre">obsolete</span> <span class="pre">legacy</span></code> directive</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>word</td>
<td>none</td>
<td>no</td>
<td>none</td>
</tr>
</tbody>
</table>
<p>The header value for <a class="reference internal" href="#httpheaderkey">httpheaderkey</a>.</p>
</div>
<div class="section" id="httpheaders">
<h4>httpheaders<a class="headerlink" href="#httpheaders" title="Permalink to this headline">¶</a></h4>
<table border="1" class="colwidths-auto parameter-table docutils">
<thead valign="bottom">
<tr class="row-odd"><th class="head">type</th>
<th class="head">default</th>
<th class="head">mandatory</th>
<th class="head"><code class="docutils literal notranslate"><span class="pre">obsolete</span> <span class="pre">legacy</span></code> directive</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>array</td>
<td>none</td>
<td>no</td>
<td>none</td>
</tr>
</tbody>
</table>
<p>An array of strings that defines a list of one or more HTTP headers to send with each message. Keep in mind that some HTTP headers are added using other parameters, “Content-Type” can be configured using <a class="reference internal" href="#httpcontenttype">httpcontenttype</a> and “Content-Encoding: gzip” is added when using the <a class="reference internal" href="#compress">compress</a> parameter.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>action(
    type=&quot;omhttp&quot;
    ...
    httpheaders=[
        &quot;X-Insert-Key: key&quot;,
        &quot;X-Event-Source: logs&quot;
    ]
    ...
)
</pre></div>
</div>
</div>
<div class="section" id="uid">
<h4>uid<a class="headerlink" href="#uid" title="Permalink to this headline">¶</a></h4>
<table border="1" class="colwidths-auto parameter-table docutils">
<thead valign="bottom">
<tr class="row-odd"><th class="head">type</th>
<th class="head">default</th>
<th class="head">mandatory</th>
<th class="head"><code class="docutils literal notranslate"><span class="pre">obsolete</span> <span class="pre">legacy</span></code> directive</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>word</td>
<td>none</td>
<td>no</td>
<td>none</td>
</tr>
</tbody>
</table>
<p>The username for basic auth.</p>
</div>
<div class="section" id="pwd">
<h4>pwd<a class="headerlink" href="#pwd" title="Permalink to this headline">¶</a></h4>
<table border="1" class="colwidths-auto parameter-table docutils">
<thead valign="bottom">
<tr class="row-odd"><th class="head">type</th>
<th class="head">default</th>
<th class="head">mandatory</th>
<th class="head"><code class="docutils literal notranslate"><span class="pre">obsolete</span> <span class="pre">legacy</span></code> directive</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>word</td>
<td>none</td>
<td>no</td>
<td>none</td>
</tr>
</tbody>
</table>
<p>The password for the user for basic auth.</p>
</div>
<div class="section" id="restpath">
<h4>restpath<a class="headerlink" href="#restpath" title="Permalink to this headline">¶</a></h4>
<table border="1" class="colwidths-auto parameter-table docutils">
<thead valign="bottom">
<tr class="row-odd"><th class="head">type</th>
<th class="head">default</th>
<th class="head">mandatory</th>
<th class="head"><code class="docutils literal notranslate"><span class="pre">obsolete</span> <span class="pre">legacy</span></code> directive</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>word</td>
<td>none</td>
<td>no</td>
<td>none</td>
</tr>
</tbody>
</table>
<p>The rest path you want to use. Do not include the leading slash character. If the full path looks like “localhost:5000/my/path”, restpath should be “my/path”.</p>
</div>
<div class="section" id="dynrestpath">
<h4>dynrestpath<a class="headerlink" href="#dynrestpath" title="Permalink to this headline">¶</a></h4>
<table border="1" class="colwidths-auto parameter-table docutils">
<thead valign="bottom">
<tr class="row-odd"><th class="head">type</th>
<th class="head">default</th>
<th class="head">mandatory</th>
<th class="head"><code class="docutils literal notranslate"><span class="pre">obsolete</span> <span class="pre">legacy</span></code> directive</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>binary</td>
<td>off</td>
<td>no</td>
<td>none</td>
</tr>
</tbody>
</table>
<p>When this parameter is set to “on” you can specify a template name in the parameter
restpath instead of the actual path. This way you will be able to use dynamic rest
paths for your messages based on the template you are using.</p>
</div>
<div class="section" id="checkpath">
<h4>checkpath<a class="headerlink" href="#checkpath" title="Permalink to this headline">¶</a></h4>
<table border="1" class="colwidths-auto parameter-table docutils">
<thead valign="bottom">
<tr class="row-odd"><th class="head">type</th>
<th class="head">default</th>
<th class="head">mandatory</th>
<th class="head"><code class="docutils literal notranslate"><span class="pre">obsolete</span> <span class="pre">legacy</span></code> directive</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>word</td>
<td>none</td>
<td>no</td>
<td>none</td>
</tr>
</tbody>
</table>
<p>The health check path you want to use. Do not include the leading slash character. If the full path looks like “localhost:5000/my/path”, checkpath should be “my/path”.
When this parameter is set, omhttp utilizes this path to determine if it is safe to resume (from suspend mode) and communicates this status back to rsyslog core.
This parameter defaults to none, which implies that health checks are not needed, and it is always safe to resume from suspend mode.</p>
<p><strong>Important</strong> - Note that it is highly recommended to set a valid health check path, as this allows omhttp to better determine whether it is safe to retry.
See the <a class="reference external" href="https://www.rsyslog.com/doc/v8-stable/configuration/actions.html">rsyslog action queue documentation for more info</a> regarding general rsyslog suspend and resume behavior.</p>
</div>
<div class="section" id="batch">
<h4>batch<a class="headerlink" href="#batch" title="Permalink to this headline">¶</a></h4>
<table border="1" class="colwidths-auto parameter-table docutils">
<thead valign="bottom">
<tr class="row-odd"><th class="head">type</th>
<th class="head">default</th>
<th class="head">mandatory</th>
<th class="head"><code class="docutils literal notranslate"><span class="pre">obsolete</span> <span class="pre">legacy</span></code> directive</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>binary</td>
<td>off</td>
<td>no</td>
<td>none</td>
</tr>
</tbody>
</table>
<p>Batch and bulkmode do the same thing, bulkmode included for backwards compatibility. See the <a class="reference internal" href="#message-batching">Message Batching</a> section for a detailed breakdown of how batching is implemented.</p>
<p>This parameter activates batching mode, which queues messages and sends them as a single request. There are several related parameters that specify the format and size of the batch: they are <a class="reference internal" href="#batch-format">batch.format</a>, <a class="reference internal" href="#batch-maxbytes">batch.maxbytes</a>, and <a class="reference internal" href="#batch-maxsize">batch.maxsize</a>.</p>
<p>Note that rsyslog core is the ultimate authority on when a batch must be submitted, due to the way that batching is implemented. This plugin implements the <a class="reference external" href="https://www.rsyslog.com/doc/v8-stable/development/dev_oplugins.html#output-plugin-transaction-interface">output plugin transaction interface</a>. There may be multiple batches in a single transaction, but a batch will never span multiple transactions. This means that if <a class="reference internal" href="#batch-maxsize">batch.maxsize</a> or <a class="reference internal" href="#batch-maxbytes">batch.maxbytes</a> is set very large, you may never actually see batches hit this size. Additionally, the number of messages per transaction is determined by the size of the main, action, and ruleset queues as well.</p>
<p>Additionally, due to some open issues with rsyslog and the transaction interface, batching requires some nuanced <a class="reference internal" href="#retry">retry</a> configuration.</p>
</div>
<div class="section" id="batch-format">
<h4>batch.format<a class="headerlink" href="#batch-format" title="Permalink to this headline">¶</a></h4>
<table border="1" class="colwidths-auto parameter-table docutils">
<thead valign="bottom">
<tr class="row-odd"><th class="head">type</th>
<th class="head">default</th>
<th class="head">mandatory</th>
<th class="head"><code class="docutils literal notranslate"><span class="pre">obsolete</span> <span class="pre">legacy</span></code> directive</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>word</td>
<td>newline</td>
<td>no</td>
<td>none</td>
</tr>
</tbody>
</table>
<p>This parameter specifies how to combine multiple messages into a single batch. Valid options are <em>newline</em> (default), <em>jsonarray</em>, <em>kafkarest</em>, and <em>lokirest</em>.</p>
<p>Each message on the “Inputs” line is the templated log line that is fed into the omhttp action, and the “Output” line describes the resulting payload sent to the configured HTTP server.</p>
<ol class="arabic simple">
<li><em>newline</em> - Concatenates each message into a single string joined by newline (“\n”) characters. This mode is default and places no restrictions on the structure of the input messages.</li>
</ol>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Inputs: &quot;message 1&quot; &quot;message 2&quot; &quot;message 3&quot;
Output: &quot;message 1\nmessage2\nmessage3&quot;
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><em>jsonarray</em> - Builds a JSON array containing all messages in the batch. This mode requires that each message is parseable JSON, since the plugin parses each message as JSON while building the array.</li>
</ol>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Inputs: {&quot;msg&quot;: &quot;message 1&quot;} {&quot;msg&quot;&quot;: &quot;message 2&quot;} {&quot;msg&quot;: &quot;message 3&quot;}
Output: [{&quot;msg&quot;: &quot;message 1&quot;}, {&quot;msg&quot;&quot;: &quot;message 2&quot;}, {&quot;msg&quot;: &quot;message 3&quot;}]
</pre></div>
</div>
<ol class="arabic simple" start="3">
<li><em>kafkarest</em> - Builds a JSON object that conforms to the <a class="reference external" href="https://docs.confluent.io/current/kafka-rest/docs/quickstart.html">Kafka Rest Proxy specification</a>. This mode requires that each message is parseable JSON, since the plugin parses each message as JSON while building the batch object.</li>
</ol>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Inputs: {&quot;stream&quot;: {&quot;tag1&quot;:&quot;value1&quot;}, values:[[ &quot;%timestamp%&quot;, &quot;message 1&quot; ]]} {&quot;stream&quot;: {&quot;tag2&quot;:&quot;value2&quot;}, values:[[ %timestamp%, &quot;message 2&quot; ]]}
Output: {&quot;streams&quot;: [{&quot;stream&quot;: {&quot;tag1&quot;:&quot;value1&quot;}, values:[[ &quot;%timestamp%&quot;, &quot;message 1&quot; ]]},{&quot;stream&quot;: {&quot;tag2&quot;:&quot;value2&quot;}, values:[[ %timestamp%, &quot;message 2&quot; ]]}]}
</pre></div>
</div>
<ol class="arabic simple" start="4">
<li><em>lokirest</em> - Builds a JSON object that conforms to the <a class="reference external" href="https://github.com/grafana/loki/blob/master/docs/api.md#post-lokiapiv1push">Loki Rest specification</a>. This mode requires that each message is parseable JSON, since the plugin parses each message as JSON while building the batch object. Additionally, the operator is responsible for providing index keys, and message values.</li>
</ol>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Inputs: {&quot;msg&quot;: &quot;message 1&quot;} {&quot;msg&quot;&quot;: &quot;message 2&quot;} {&quot;msg&quot;: &quot;message 3&quot;}
Output: {&quot;records&quot;: [{&quot;value&quot;: {&quot;msg&quot;: &quot;message 1&quot;}}, {&quot;value&quot;: {&quot;msg&quot;: &quot;message 2&quot;}}, {&quot;value&quot;: {&quot;msg&quot;: &quot;message 3&quot;}}]}
</pre></div>
</div>
</div>
<div class="section" id="batch-maxsize">
<h4>batch.maxsize<a class="headerlink" href="#batch-maxsize" title="Permalink to this headline">¶</a></h4>
<table border="1" class="colwidths-auto parameter-table docutils">
<thead valign="bottom">
<tr class="row-odd"><th class="head">type</th>
<th class="head">default</th>
<th class="head">mandatory</th>
<th class="head"><code class="docutils literal notranslate"><span class="pre">obsolete</span> <span class="pre">legacy</span></code> directive</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Size</td>
<td>100</td>
<td>no</td>
<td>none</td>
</tr>
</tbody>
</table>
<p>This parameter specifies the maximum number of messages that will be sent in each batch.</p>
</div>
<div class="section" id="batch-maxbytes">
<h4>batch.maxbytes<a class="headerlink" href="#batch-maxbytes" title="Permalink to this headline">¶</a></h4>
<table border="1" class="colwidths-auto parameter-table docutils">
<thead valign="bottom">
<tr class="row-odd"><th class="head">type</th>
<th class="head">default</th>
<th class="head">mandatory</th>
<th class="head"><code class="docutils literal notranslate"><span class="pre">obsolete</span> <span class="pre">legacy</span></code> directive</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Size</td>
<td>10485760 (10MB)</td>
<td>no</td>
<td>none</td>
</tr>
</tbody>
</table>
<p>batch.maxbytes and maxbytes do the same thing, maxbytes included for backwards compatibility.</p>
<p>This parameter specifies the maximum size in bytes for each batch.</p>
</div>
<div class="section" id="template">
<h4>template<a class="headerlink" href="#template" title="Permalink to this headline">¶</a></h4>
<table border="1" class="colwidths-auto parameter-table docutils">
<thead valign="bottom">
<tr class="row-odd"><th class="head">type</th>
<th class="head">default</th>
<th class="head">mandatory</th>
<th class="head"><code class="docutils literal notranslate"><span class="pre">obsolete</span> <span class="pre">legacy</span></code> directive</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>word</td>
<td>StdJSONFmt</td>
<td>no</td>
<td>none</td>
</tr>
</tbody>
</table>
<p>The template to be used for the messages.</p>
<p>Note that in batching mode, this describes the format of <em>each</em> individual message, <em>not</em> the format of the resulting batch. Some batch modes require that a template produces valid JSON.</p>
</div>
<div class="section" id="retry">
<h4>retry<a class="headerlink" href="#retry" title="Permalink to this headline">¶</a></h4>
<table border="1" class="colwidths-auto parameter-table docutils">
<thead valign="bottom">
<tr class="row-odd"><th class="head">type</th>
<th class="head">default</th>
<th class="head">mandatory</th>
<th class="head"><code class="docutils literal notranslate"><span class="pre">obsolete</span> <span class="pre">legacy</span></code> directive</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>binary</td>
<td>off</td>
<td>no</td>
<td>none</td>
</tr>
</tbody>
</table>
<p>This parameter specifies whether failed requests should be retried using the custom retry logic implemented in this plugin. Requests returning 5XX HTTP status codes are considered retriable. If retry is enabled, set <a class="reference internal" href="#retry-ruleset">retry.ruleset</a> as well.</p>
<p>Note that retries are generally handled in rsyslog by setting action.resumeRetryCount=”-1” (or some other integer), and the plugin lets rsyslog know it should start retrying by suspending itself. This is still the recommended approach in the 2 cases enumerated below when using this plugin. In both of these cases, the output plugin transaction interface is not used. That is, from rsyslog core’s point of view, each message is contained in its own transaction.</p>
<ol class="arabic simple">
<li>Batching is off (batch=”off”)</li>
<li>Batching is on and the maximum batch size is 1 (batch=”on” batch.maxsize=”1”)</li>
</ol>
<p>This custom retry behavior is the result of a bug in rsyslog’s handling of transaction commits. See <a class="reference external" href="https://github.com/rsyslog/rsyslog/issues/2420">this issue</a> for full details. Essentially, if rsyslog hands omhttp 4 messages, and omhttp batches them up but the request fails, rsyslog will only retry the LAST message that it handed the plugin, instead of all 4, even if the plugin returns the correct “defer commit” statuses for messages 1, 2, and 3. This means that omhttp cannot rely on action.resumeRetryCount for any transaction that processes more than a single message, and explains why the 2 above cases do work correctly.</p>
<p>It looks promising that issue will be resolved at some point, so this behavior can be revisited at that time.</p>
</div>
<div class="section" id="retry-ruleset">
<h4>retry.ruleset<a class="headerlink" href="#retry-ruleset" title="Permalink to this headline">¶</a></h4>
<table border="1" class="colwidths-auto parameter-table docutils">
<thead valign="bottom">
<tr class="row-odd"><th class="head">type</th>
<th class="head">default</th>
<th class="head">mandatory</th>
<th class="head"><code class="docutils literal notranslate"><span class="pre">obsolete</span> <span class="pre">legacy</span></code> directive</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>word</td>
<td>none</td>
<td>no</td>
<td>none</td>
</tr>
</tbody>
</table>
<p>This parameter specifies the ruleset where this plugin should requeue failed messages if <a class="reference internal" href="#retry">retry</a> is on. This ruleset generally would contain another omhttp action instance.</p>
<p><strong>Important</strong> - Note that the message that is queued on the retry ruleset is the templated output of the initial omhttp action. This means that no further templating should be done to messages inside this ruleset, unless retries should be templated differently than first-tries. An “echo template” does the trick here.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>template(name=&quot;tpl_echo&quot; type=&quot;string&quot; string=&quot;%msg%&quot;)
</pre></div>
</div>
<p>This retry ruleset can recursively call itself as its own retry.ruleset to retry forever, but there is no timeout behavior currently implemented.</p>
<p>Alternatively, the omhttp action in the retry ruleset could be configured to support action.resumeRetryCount as explained above in the retry parameter section. The benefit of this approach is that retried messages still hit the server in a batch format (though with a single message in it), and the ability to configure rsyslog to give up after some number of resume attempts so as to avoid resource exhaustion.</p>
<p>Or, if some data loss or high latency is acceptable, do not configure retries with the retry ruleset itself. A single retry from the original ruleset might catch most failures, and errors from the retry ruleset could still be logged using the errorfile parameter and sent later on via some other process.</p>
</div>
<div class="section" id="ratelimit-interval">
<h4>ratelimit.interval<a class="headerlink" href="#ratelimit-interval" title="Permalink to this headline">¶</a></h4>
<table border="1" class="colwidths-auto parameter-table docutils">
<thead valign="bottom">
<tr class="row-odd"><th class="head">type</th>
<th class="head">default</th>
<th class="head">mandatory</th>
<th class="head"><code class="docutils literal notranslate"><span class="pre">obsolete</span> <span class="pre">legacy</span></code> directive</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>integer</td>
<td>600</td>
<td>no</td>
<td>none</td>
</tr>
</tbody>
</table>
<p>This parameter sets the rate limiting behavior for the <a class="reference internal" href="#retry-ruleset">retry.ruleset</a>. Specifies the interval in seconds onto which rate-limiting is to be applied. If more than ratelimit.burst messages are read during that interval, further messages up to the end of the interval are discarded. The number of messages discarded is emitted at the end of the interval (if there were any discards). Setting this to value zero turns off ratelimiting.</p>
</div>
<div class="section" id="ratelimit-burst">
<h4>ratelimit.burst<a class="headerlink" href="#ratelimit-burst" title="Permalink to this headline">¶</a></h4>
<table border="1" class="colwidths-auto parameter-table docutils">
<thead valign="bottom">
<tr class="row-odd"><th class="head">type</th>
<th class="head">default</th>
<th class="head">mandatory</th>
<th class="head"><code class="docutils literal notranslate"><span class="pre">obsolete</span> <span class="pre">legacy</span></code> directive</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>integer</td>
<td>20000</td>
<td>no</td>
<td>none</td>
</tr>
</tbody>
</table>
<p>This parameter sets the rate limiting behavior for the <a class="reference internal" href="#retry-ruleset">retry.ruleset</a>. Specifies the maximum number of messages that can be emitted within the ratelimit.interval interval. For further information, see description there.</p>
</div>
<div class="section" id="errorfile">
<h4>errorfile<a class="headerlink" href="#errorfile" title="Permalink to this headline">¶</a></h4>
<table border="1" class="colwidths-auto parameter-table docutils">
<thead valign="bottom">
<tr class="row-odd"><th class="head">type</th>
<th class="head">default</th>
<th class="head">mandatory</th>
<th class="head"><code class="docutils literal notranslate"><span class="pre">obsolete</span> <span class="pre">legacy</span></code> directive</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>word</td>
<td>none</td>
<td>no</td>
<td>none</td>
</tr>
</tbody>
</table>
<p>Here you can set the name of a file where all errors will be written to. Any request that returns a 4XX or 5XX HTTP code is recorded in the error file. Each line is JSON formatted with “request” and “response” fields, example pretty-printed below.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>{
    &quot;request&quot;: {
        &quot;url&quot;: &quot;https://url.com:443/path&quot;,
        &quot;postdata&quot;: &quot;mypayload&quot;
    },
    &quot;response&quot; : {
        &quot;status&quot;: 400,
        &quot;message&quot;: &quot;error string&quot;
    }
}
</pre></div>
</div>
<p>It is intended that a full replay of failed data is possible by processing this file.</p>
</div>
<div class="section" id="compress">
<h4>compress<a class="headerlink" href="#compress" title="Permalink to this headline">¶</a></h4>
<table border="1" class="colwidths-auto parameter-table docutils">
<thead valign="bottom">
<tr class="row-odd"><th class="head">type</th>
<th class="head">default</th>
<th class="head">mandatory</th>
<th class="head"><code class="docutils literal notranslate"><span class="pre">obsolete</span> <span class="pre">legacy</span></code> directive</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>binary</td>
<td>off</td>
<td>no</td>
<td>none</td>
</tr>
</tbody>
</table>
<p>When switched to “on” each message will be compressed as GZIP using zlib’s deflate compression algorithm.</p>
<p>A “Content-Encoding: gzip” HTTP header is added to each request when this feature is used. Set the <a class="reference internal" href="#compress-level">compress.level</a> for fine-grained control.</p>
</div>
<div class="section" id="compress-level">
<h4>compress.level<a class="headerlink" href="#compress-level" title="Permalink to this headline">¶</a></h4>
<table border="1" class="colwidths-auto parameter-table docutils">
<thead valign="bottom">
<tr class="row-odd"><th class="head">type</th>
<th class="head">default</th>
<th class="head">mandatory</th>
<th class="head"><code class="docutils literal notranslate"><span class="pre">obsolete</span> <span class="pre">legacy</span></code> directive</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>integer</td>
<td>-1</td>
<td>no</td>
<td>none</td>
</tr>
</tbody>
</table>
<p>Specify the zlib compression level if <a class="reference internal" href="#compress">compress</a> is enabled. Check the <a class="reference external" href="https://www.zlib.net/manual.html">zlib manual</a> for further documentation.</p>
<p>“-1” is the default value that strikes a balance between best speed and best compression. “0” disables compression. “1” results in the fastest compression. “9” results in the best compression.</p>
</div>
<div class="section" id="usehttps">
<h4>useHttps<a class="headerlink" href="#usehttps" title="Permalink to this headline">¶</a></h4>
<table border="1" class="colwidths-auto parameter-table docutils">
<thead valign="bottom">
<tr class="row-odd"><th class="head">type</th>
<th class="head">default</th>
<th class="head">mandatory</th>
<th class="head"><code class="docutils literal notranslate"><span class="pre">obsolete</span> <span class="pre">legacy</span></code> directive</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>binary</td>
<td>off</td>
<td>no</td>
<td>none</td>
</tr>
</tbody>
</table>
<p>When switched to “on” you will use https instead of http.</p>
</div>
<div class="section" id="tls-cacert">
<h4>tls.cacert<a class="headerlink" href="#tls-cacert" title="Permalink to this headline">¶</a></h4>
<table border="1" class="colwidths-auto parameter-table docutils">
<thead valign="bottom">
<tr class="row-odd"><th class="head">type</th>
<th class="head">default</th>
<th class="head">mandatory</th>
<th class="head"><code class="docutils literal notranslate"><span class="pre">obsolete</span> <span class="pre">legacy</span></code> directive</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>word</td>
<td>none</td>
<td>no</td>
<td>none</td>
</tr>
</tbody>
</table>
<p>This parameter sets the path to the Certificate Authority (CA) bundle. Expects .pem format.</p>
</div>
<div class="section" id="tls-mycert">
<h4>tls.mycert<a class="headerlink" href="#tls-mycert" title="Permalink to this headline">¶</a></h4>
<table border="1" class="colwidths-auto parameter-table docutils">
<thead valign="bottom">
<tr class="row-odd"><th class="head">type</th>
<th class="head">default</th>
<th class="head">mandatory</th>
<th class="head"><code class="docutils literal notranslate"><span class="pre">obsolete</span> <span class="pre">legacy</span></code> directive</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>word</td>
<td>none</td>
<td>no</td>
<td>none</td>
</tr>
</tbody>
</table>
<p>This parameter sets the path to the SSL client certificate. Expects .pem format.</p>
</div>
<div class="section" id="tls-myprivkey">
<h4>tls.myprivkey<a class="headerlink" href="#tls-myprivkey" title="Permalink to this headline">¶</a></h4>
<table border="1" class="colwidths-auto parameter-table docutils">
<thead valign="bottom">
<tr class="row-odd"><th class="head">type</th>
<th class="head">default</th>
<th class="head">mandatory</th>
<th class="head"><code class="docutils literal notranslate"><span class="pre">obsolete</span> <span class="pre">legacy</span></code> directive</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>word</td>
<td>none</td>
<td>no</td>
<td>none</td>
</tr>
</tbody>
</table>
<p>The parameters sets the path to the SSL private key. Expects .pem format.</p>
</div>
<div class="section" id="allowunsignedcerts">
<h4>allowunsignedcerts<a class="headerlink" href="#allowunsignedcerts" title="Permalink to this headline">¶</a></h4>
<table border="1" class="colwidths-auto parameter-table docutils">
<thead valign="bottom">
<tr class="row-odd"><th class="head">type</th>
<th class="head">default</th>
<th class="head">mandatory</th>
<th class="head"><code class="docutils literal notranslate"><span class="pre">obsolete</span> <span class="pre">legacy</span></code> directive</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>boolean</td>
<td>off</td>
<td>no</td>
<td>none</td>
</tr>
</tbody>
</table>
<p>If <cite>“on”</cite>, this will set the curl <cite>CURLOPT_SSL_VERIFYPEER</cite> option to
<cite>0</cite>.  You are strongly discouraged to set this to <cite>“on”</cite>.  It is
primarily useful only for debugging or testing.</p>
</div>
<div class="section" id="skipverifyhost">
<h4>skipverifyhost<a class="headerlink" href="#skipverifyhost" title="Permalink to this headline">¶</a></h4>
<table border="1" class="colwidths-auto parameter-table docutils">
<thead valign="bottom">
<tr class="row-odd"><th class="head">type</th>
<th class="head">default</th>
<th class="head">mandatory</th>
<th class="head"><code class="docutils literal notranslate"><span class="pre">obsolete</span> <span class="pre">legacy</span></code> directive</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>boolean</td>
<td>off</td>
<td>no</td>
<td>none</td>
</tr>
</tbody>
</table>
<p>If <cite>“on”</cite>, this will set the curl <cite>CURLOPT_SSL_VERIFYHOST</cite> option to
<cite>0</cite>.  You are strongly discouraged to set this to <cite>“on”</cite>.  It is
primarily useful only for debugging or testing.</p>
</div>
<div class="section" id="reloadonhup">
<h4>reloadonhup<a class="headerlink" href="#reloadonhup" title="Permalink to this headline">¶</a></h4>
<table border="1" class="colwidths-auto parameter-table docutils">
<thead valign="bottom">
<tr class="row-odd"><th class="head">type</th>
<th class="head">default</th>
<th class="head">mandatory</th>
<th class="head"><code class="docutils literal notranslate"><span class="pre">obsolete</span> <span class="pre">legacy</span></code> directive</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>binary</td>
<td>off</td>
<td>no</td>
<td>none</td>
</tr>
</tbody>
</table>
<p>If this parameter is “on”, the plugin will close and reopen any libcurl handles on a HUP signal. This option is primarily intended to enable reloading short-lived certificates without restarting rsyslog.</p>
</div>
</div>
</div>
<div class="section" id="statistic-counter">
<h2>Statistic Counter<a class="headerlink" href="#statistic-counter" title="Permalink to this headline">¶</a></h2>
<p>This plugin maintains global <a class="reference internal" href="../rsyslog_statistic_counter.html"><span class="doc">statistics</span></a> for omhttp that
accumulates all action instances. The statistic origin is named “omhttp” with following counters:</p>
<ul class="simple">
<li><strong>messages.submitted</strong> - Number of messages submitted to omhttp. Messages resubmitted via a retry ruleset will be counted twice.</li>
<li><strong>messages.success</strong> - Number of messages successfully sent.</li>
<li><strong>messages.fail</strong> - Number of messages that omhttp failed to deliver for any reason.</li>
<li><strong>messages.retry</strong> - Number of messages that omhttp resubmitted for retry via the retry ruleset.</li>
<li><strong>request.count</strong> - Number of attempted HTTP requests.</li>
<li><strong>request.success</strong> - Number of successful HTTP requests. A successful request can return <em>any</em> HTTP status code.</li>
<li><strong>request.fail</strong> - Number of failed HTTP requests. A failed request is something like an invalid SSL handshake, or the server is not reachable. Requests returning 4XX or 5XX HTTP status codes are <em>not</em> failures.</li>
<li><strong>request.status.success</strong> - Number of requests returning 1XX or 2XX HTTP status codes.</li>
<li><strong>request.status.fail</strong> - Number of requests returning 3XX, 4XX, or 5XX HTTP status codes. If a requests fails (i.e. server not reachable) this counter will <em>not</em> be incremented.</li>
</ul>
</div>
<div class="section" id="message-batching">
<h2>Message Batching<a class="headerlink" href="#message-batching" title="Permalink to this headline">¶</a></h2>
<p>See the <a class="reference internal" href="#batch-format">batch.format</a> section for some light examples of available batching formats.</p>
<div class="section" id="implementation">
<h3>Implementation<a class="headerlink" href="#implementation" title="Permalink to this headline">¶</a></h3>
<p>Here’s the pseudocode of the batching algorithm used by omhttp. This section of code would run once per transaction.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">Q</span> <span class="o">=</span> <span class="n">Queue</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">submit</span><span class="p">(</span><span class="n">Q</span><span class="p">):</span>                      <span class="c1"># function to submit</span>
    <span class="n">batch</span> <span class="o">=</span> <span class="n">serialize</span><span class="p">(</span><span class="n">Q</span><span class="p">)</span>            <span class="c1"># serialize according to configured batch.format</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">post</span><span class="p">(</span><span class="n">batch</span><span class="p">)</span>            <span class="c1"># http post serialized batch to server</span>
    <span class="n">checkFailureAndRetry</span><span class="p">(</span><span class="n">Q</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span> <span class="c1"># check if post failed and pushed failed messages to configured retry.ruleset</span>
    <span class="n">Q</span><span class="o">.</span><span class="n">empty</span><span class="p">()</span>                       <span class="c1"># reset for next batch</span>


<span class="k">while</span> <span class="n">isActive</span><span class="p">(</span><span class="n">transaction</span><span class="p">):</span>            <span class="c1"># rsyslog manages the transaction</span>
    <span class="n">message</span> <span class="o">=</span> <span class="n">receiveMessage</span><span class="p">()</span>          <span class="c1"># rsyslog sends us messages</span>
    <span class="k">if</span> <span class="n">wouldTriggerSubmit</span><span class="p">(</span><span class="n">Q</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>  <span class="c1"># if this message puts us over maxbytes or maxsize</span>
        <span class="n">submit</span><span class="p">(</span><span class="n">Q</span><span class="p">)</span>                       <span class="c1"># submit the current batch</span>
    <span class="n">Q</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>                     <span class="c1"># queue this message on the current batch</span>

<span class="n">submit</span><span class="p">(</span><span class="n">Q</span><span class="p">)</span>   <span class="c1"># transaction is over, submit what is currently in the queue</span>
</pre></div>
</div>
</div>
<div class="section" id="walkthrough">
<h3>Walkthrough<a class="headerlink" href="#walkthrough" title="Permalink to this headline">¶</a></h3>
<p>This is a run through of a file tailing to omhttp scenario. Suppose we have a file called <code class="docutils literal notranslate"><span class="pre">/var/log/my.log</span></code> with this content..</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>001 message
002 message
003 message
004 message
005 message
006 message
007 message
...
</pre></div>
</div>
<p>We are tailing this using imfile and defining a template to generate a JSON payload…</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>input(type=&quot;imfile&quot; File=&quot;/var/log/my.log&quot; ruleset=&quot;rs_omhttp&quot; ... )

# Produces JSON formatted payload
template(name=&quot;tpl_omhttp_json&quot; type=&quot;list&quot;) {
    constant(value=&quot;{&quot;)   property(name=&quot;msg&quot;           outname=&quot;message&quot;   format=&quot;jsonfr&quot;)
    constant(value=&quot;,&quot;)   property(name=&quot;hostname&quot;      outname=&quot;host&quot;      format=&quot;jsonfr&quot;)
    constant(value=&quot;,&quot;)   property(name=&quot;timereported&quot;  outname=&quot;timestamp&quot; format=&quot;jsonfr&quot; dateFormat=&quot;rfc3339&quot;)
    constant(value=&quot;}&quot;)
}
</pre></div>
</div>
<p>Our omhttp ruleset is configured to batch using the <em>jsonarray</em> format with 5 messages per batch, and to use a retry ruleset.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>module(load=&quot;omhttp&quot;)

ruleset(name=&quot;rs_omhttp&quot;) {
    action(
        type=&quot;omhttp&quot;
        template=&quot;tpl_omhttp_json&quot;
        batch=&quot;on&quot;
        batch.format=&quot;jsonarray&quot;
        batch.maxsize=&quot;5&quot;
        retry=&quot;on&quot;
        retry.ruleset=&quot;rs_omhttp_retry&quot;
        ...
    )
}

call rs_omhttp
</pre></div>
</div>
<p>Each input message to this omhttp action is the output of <code class="docutils literal notranslate"><span class="pre">tpl_omhttp_json</span></code> with the following structure..</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>{&quot;message&quot;: &quot;001 message&quot;, &quot;host&quot;: &quot;localhost&quot;, &quot;timestamp&quot;: &quot;2018-12-28T21:14:13.840470+00:00&quot;}
</pre></div>
</div>
<p>After 5 messages have been queued, and a batch submit is triggered, omhttp serializes the messages as a JSON array and attempts to post the batch to the server. At this point the payload on the wire looks like this..</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>[
    {&quot;message&quot;: &quot;001 message&quot;, &quot;host&quot;: &quot;localhost&quot;, &quot;timestamp&quot;: &quot;2018-12-28T21:14:13.000000+00:00&quot;},
    {&quot;message&quot;: &quot;002 message&quot;, &quot;host&quot;: &quot;localhost&quot;, &quot;timestamp&quot;: &quot;2018-12-28T21:14:14.000000+00:00&quot;},
    {&quot;message&quot;: &quot;003 message&quot;, &quot;host&quot;: &quot;localhost&quot;, &quot;timestamp&quot;: &quot;2018-12-28T21:14:15.000000+00:00&quot;},
    {&quot;message&quot;: &quot;004 message&quot;, &quot;host&quot;: &quot;localhost&quot;, &quot;timestamp&quot;: &quot;2018-12-28T21:14:16.000000+00:00&quot;},
    {&quot;message&quot;: &quot;005 message&quot;, &quot;host&quot;: &quot;localhost&quot;, &quot;timestamp&quot;: &quot;2018-12-28T21:14:17.000000+00:00&quot;}
]
</pre></div>
</div>
<p>If the request fails, omhttp requeues each failed message onto the retry ruleset. However, recall that the inputs to the <code class="docutils literal notranslate"><span class="pre">rs_omhttp</span></code> ruleset are the rendered <em>outputs</em> of <code class="docutils literal notranslate"><span class="pre">tpl_json_omhttp</span></code>, and therefore we <em>cannot</em> use the same template (and therefore the same action instance) to produce the retry messages. At this point, the <code class="docutils literal notranslate"><span class="pre">msg</span></code> rsyslog property is <code class="docutils literal notranslate"><span class="pre">{&quot;message&quot;:</span> <span class="pre">&quot;001</span> <span class="pre">message&quot;,</span> <span class="pre">&quot;host&quot;:</span> <span class="pre">&quot;localhost&quot;,</span> <span class="pre">&quot;timestamp&quot;:</span> <span class="pre">&quot;2018-12-28T21:14:13.000000+00:00&quot;}</span></code> instead of the original <code class="docutils literal notranslate"><span class="pre">001</span> <span class="pre">message</span></code>, and <code class="docutils literal notranslate"><span class="pre">tpl_json_omhttp</span></code> would render incorrect payloads.</p>
<p>Instead we define a simple template that echos its input..</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>template(name=&quot;tpl_echo&quot; type=&quot;string&quot; string=&quot;%msg%&quot;)
</pre></div>
</div>
<p>And assign it to the retry template..</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>ruleset(name=&quot;rs_omhttp_retry&quot;) {
    action(
        type=&quot;omhttp&quot;
        template=&quot;tpl_echo&quot;
        batch=&quot;on&quot;
        batch.format=&quot;jsonarray&quot;
        batch.maxsize=&quot;5&quot;
        ...
    )
}
</pre></div>
</div>
<p>And the destination is none the wiser! The <em>newline</em>, <em>jsonarray</em>, and <em>kafkarest</em> formats all behave in the same way with respect to their batching and retry behavior, and differ only in the format of the on-the-wire payload. The formats themselves are described in the <a class="reference internal" href="#batch-format">batch.format</a> section.</p>
</div>
</div>
<div class="section" id="examples">
<h2>Examples<a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h2>
<div class="section" id="example-1">
<h3>Example 1<a class="headerlink" href="#example-1" title="Permalink to this headline">¶</a></h3>
<p>The following example is a basic usage, first the module is loaded and then
the action is used with a standard retry strategy.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>module(load=&quot;omhttp&quot;)
template(name=&quot;tpl1&quot; type=&quot;string&quot; string=&quot;{\&quot;type\&quot;:\&quot;syslog\&quot;, \&quot;host\&quot;:\&quot;%HOSTNAME%\&quot;}&quot;)
action(
    type=&quot;omhttp&quot;
    server=&quot;127.0.0.1&quot;
    serverport=&quot;8080&quot;
    restpath=&quot;events&quot;
    template=&quot;tpl1&quot;
    action.resumeRetryCount=&quot;3&quot;
)
</pre></div>
</div>
</div>
<div class="section" id="example-2">
<h3>Example 2<a class="headerlink" href="#example-2" title="Permalink to this headline">¶</a></h3>
<p>The following example is a basic batch usage with no retry processing.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>module(load=&quot;omhttp&quot;)
template(name=&quot;tpl1&quot; type=&quot;string&quot; string=&quot;{\&quot;type\&quot;:\&quot;syslog\&quot;, \&quot;host\&quot;:\&quot;%HOSTNAME%\&quot;}&quot;)
action(
    type=&quot;omhttp&quot;
    server=&quot;127.0.0.1&quot;
    serverport=&quot;8080&quot;
    restpath=&quot;events&quot;
    template=&quot;tpl1&quot;
    batch=&quot;on&quot;
    batch.format=&quot;jsonarray&quot;
    batch.maxsize=&quot;10&quot;
)
</pre></div>
</div>
</div>
<div class="section" id="example-3">
<h3>Example 3<a class="headerlink" href="#example-3" title="Permalink to this headline">¶</a></h3>
<p>The following example is a batch usage with a retry ruleset that retries forever</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>module(load=&quot;omhttp&quot;)

template(name=&quot;tpl_echo&quot; type=&quot;string&quot; string=&quot;%msg%&quot;)
ruleset(name=&quot;rs_retry_forever&quot;) {
    action(
        type=&quot;omhttp&quot;
        server=&quot;127.0.0.1&quot;
        serverport=&quot;8080&quot;
        restpath=&quot;events&quot;
        template=&quot;tpl_echo&quot;

        batch=&quot;on&quot;
        batch.format=&quot;jsonarray&quot;
        batch.maxsize=&quot;10&quot;

        retry=&quot;on&quot;
        retry.ruleset=&quot;rs_retry_forever&quot;
    )
}

template(name=&quot;tpl1&quot; type=&quot;string&quot; string=&quot;{\&quot;type\&quot;:\&quot;syslog\&quot;, \&quot;host\&quot;:\&quot;%HOSTNAME%\&quot;}&quot;)
action(
    type=&quot;omhttp&quot;
    server=&quot;127.0.0.1&quot;
    serverport=&quot;8080&quot;
    restpath=&quot;events&quot;
    template=&quot;tpl1&quot;

    batch=&quot;on&quot;
    batch.format=&quot;jsonarray&quot;
    batch.maxsize=&quot;10&quot;

    retry=&quot;on&quot;
    retry.ruleset=&quot;rs_retry_forever&quot;
)
</pre></div>
</div>
</div>
<div class="section" id="example-4">
<h3>Example 4<a class="headerlink" href="#example-4" title="Permalink to this headline">¶</a></h3>
<p>The following example is a batch usage with a couple retry options</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>module(load=&quot;omhttp&quot;)

template(name=&quot;tpl_echo&quot; type=&quot;string&quot; string=&quot;%msg%&quot;)

# This retry ruleset tries to send batches once then logs failures.
# Error log could be tailed by rsyslog itself or processed by some
# other program.
ruleset(name=&quot;rs_retry_once_errorfile&quot;) {
    action(
        type=&quot;omhttp&quot;
        server=&quot;127.0.0.1&quot;
        serverport=&quot;8080&quot;
        restpath=&quot;events&quot;
        template=&quot;tpl_echo&quot;

        batch=&quot;on&quot;
        batch.format=&quot;jsonarray&quot;
        batch.maxsize=&quot;10&quot;

        retry=&quot;off&quot;
        errorfile=&quot;/var/log/rsyslog/omhttp_errors.log&quot;
    )
}

# This retry ruleset gives up trying to batch messages and instead always
# uses a batch size of 1, relying on the suspend/resume mechanism to do
# further retries if needed.
ruleset(name=&quot;rs_retry_batchsize_1&quot;) {
    action(
        type=&quot;omhttp&quot;
        server=&quot;127.0.0.1&quot;
        serverport=&quot;8080&quot;
        restpath=&quot;events&quot;
        template=&quot;tpl_echo&quot;

        batch=&quot;on&quot;
        batch.format=&quot;jsonarray&quot;
        batch.maxsize=&quot;1&quot;
        action.resumeRetryCount=&quot;-1&quot;
    )
}

template(name=&quot;tpl1&quot; type=&quot;string&quot; string=&quot;{\&quot;type\&quot;:\&quot;syslog\&quot;, \&quot;host\&quot;:\&quot;%HOSTNAME%\&quot;}&quot;)
action(
    type=&quot;omhttp&quot;
    template=&quot;tpl1&quot;

    ...

    retry=&quot;on&quot;
    retry.ruleset=&quot;&lt;some_retry_ruleset&gt;&quot;
)
</pre></div>
</div>
</div>
<div class="section" id="example-5">
<h3>Example 5<a class="headerlink" href="#example-5" title="Permalink to this headline">¶</a></h3>
<p>The following example is a batch action for pushing logs with checking, and queues to Loki.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>module(load=&quot;omhttp&quot;)

template(name=&quot;loki&quot; type=&quot;string&quot; string=&quot;{\&quot;stream\&quot;:{\&quot;host\&quot;:\&quot;%HOSTNAME%\&quot;,\&quot;facility\&quot;:\&quot;%syslogfacility-text%\&quot;,\&quot;priority\&quot;:\&quot;%syslogpriority-text%\&quot;,\&quot;syslogtag\&quot;:\&quot;%syslogtag%\&quot;},\&quot;values\&quot;: [[ \&quot;%timegenerated:::date-unixtimestamp%000000000\&quot;, \&quot;%msg%\&quot; ]]}&quot;)


action(
    name=&quot;loki&quot;
    type=&quot;omhttp&quot;
    useHttps=&quot;off&quot;
    server=&quot;localhost&quot;
    serverport=&quot;3100&quot;
    checkpath=&quot;ready&quot;

    restpath=&quot;loki/api/v1/push&quot;
    template=&quot;loki&quot;
    batch.format=&quot;lokirest&quot;
    batch=&quot;on&quot;
    batch.maxsize=&quot;10&quot;

    queue.size=&quot;10000&quot; queue.type=&quot;linkedList&quot;
    queue.workerthreads=&quot;3&quot;
    queue.workerthreadMinimumMessages=&quot;1000&quot;
    queue.timeoutWorkerthreadShutdown=&quot;500&quot;
    queue.timeoutEnqueue=&quot;10000&quot;
)
</pre></div>
</div>
<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<p>Help with configuring/using <code class="docutils literal notranslate"><span class="pre">Rsyslog</span></code>:</p>
<ul class="last simple">
<li><a class="reference external" href="http://lists.adiscon.net/mailman/listinfo/rsyslog">Mailing list</a> - best route for general questions</li>
<li>GitHub: <a class="reference external" href="https://github.com/rsyslog/rsyslog/">rsyslog source project</a> - detailed questions, reporting issues
that are believed to be bugs with <code class="docutils literal notranslate"><span class="pre">Rsyslog</span></code></li>
<li>Stack Exchange (<a class="reference external" href="https://stackexchange.com/filters/327462/rsyslog">View</a>, <a class="reference external" href="https://serverfault.com/questions/ask?tags=rsyslog">Ask</a>)
- experimental support from rsyslog community</li>
</ul>
</div>
<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<p>Contributing to <code class="docutils literal notranslate"><span class="pre">Rsyslog</span></code>:</p>
<ul class="last simple">
<li>Source project: <a class="reference external" href="https://github.com/rsyslog/rsyslog/blob/master/README.md">rsyslog project README</a>.</li>
<li>Documentation: <a class="reference external" href="https://github.com/rsyslog/rsyslog-doc/blob/master/README.md">rsyslog-doc project README</a></li>
</ul>
</div>
<p>Copyright 2008-2020 <a class="reference external" href="https://rainer.gerhards.net/">Rainer Gerhards</a>
(<a class="reference external" href="https://www.rainer-gerhards.de/grossrinderfeld/">Großrinderfeld</a>),
and Others.</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../../index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">omhttp: HTTP Output Module</a><ul>
<li><a class="reference internal" href="#purpose">Purpose</a></li>
<li><a class="reference internal" href="#notable-features">Notable Features</a></li>
<li><a class="reference internal" href="#configuration-parameters">Configuration Parameters</a><ul>
<li><a class="reference internal" href="#action-parameters">Action Parameters</a><ul>
<li><a class="reference internal" href="#server">Server</a></li>
<li><a class="reference internal" href="#serverport">Serverport</a></li>
<li><a class="reference internal" href="#healthchecktimeout">healthchecktimeout</a></li>
<li><a class="reference internal" href="#httpcontenttype">httpcontenttype</a></li>
<li><a class="reference internal" href="#httpheaderkey">httpheaderkey</a></li>
<li><a class="reference internal" href="#httpheadervalue">httpheadervalue</a></li>
<li><a class="reference internal" href="#httpheaders">httpheaders</a></li>
<li><a class="reference internal" href="#uid">uid</a></li>
<li><a class="reference internal" href="#pwd">pwd</a></li>
<li><a class="reference internal" href="#restpath">restpath</a></li>
<li><a class="reference internal" href="#dynrestpath">dynrestpath</a></li>
<li><a class="reference internal" href="#checkpath">checkpath</a></li>
<li><a class="reference internal" href="#batch">batch</a></li>
<li><a class="reference internal" href="#batch-format">batch.format</a></li>
<li><a class="reference internal" href="#batch-maxsize">batch.maxsize</a></li>
<li><a class="reference internal" href="#batch-maxbytes">batch.maxbytes</a></li>
<li><a class="reference internal" href="#template">template</a></li>
<li><a class="reference internal" href="#retry">retry</a></li>
<li><a class="reference internal" href="#retry-ruleset">retry.ruleset</a></li>
<li><a class="reference internal" href="#ratelimit-interval">ratelimit.interval</a></li>
<li><a class="reference internal" href="#ratelimit-burst">ratelimit.burst</a></li>
<li><a class="reference internal" href="#errorfile">errorfile</a></li>
<li><a class="reference internal" href="#compress">compress</a></li>
<li><a class="reference internal" href="#compress-level">compress.level</a></li>
<li><a class="reference internal" href="#usehttps">useHttps</a></li>
<li><a class="reference internal" href="#tls-cacert">tls.cacert</a></li>
<li><a class="reference internal" href="#tls-mycert">tls.mycert</a></li>
<li><a class="reference internal" href="#tls-myprivkey">tls.myprivkey</a></li>
<li><a class="reference internal" href="#allowunsignedcerts">allowunsignedcerts</a></li>
<li><a class="reference internal" href="#skipverifyhost">skipverifyhost</a></li>
<li><a class="reference internal" href="#reloadonhup">reloadonhup</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#statistic-counter">Statistic Counter</a></li>
<li><a class="reference internal" href="#message-batching">Message Batching</a><ul>
<li><a class="reference internal" href="#implementation">Implementation</a></li>
<li><a class="reference internal" href="#walkthrough">Walkthrough</a></li>
</ul>
</li>
<li><a class="reference internal" href="#examples">Examples</a><ul>
<li><a class="reference internal" href="#example-1">Example 1</a></li>
<li><a class="reference internal" href="#example-2">Example 2</a></li>
<li><a class="reference internal" href="#example-3">Example 3</a></li>
<li><a class="reference internal" href="#example-4">Example 4</a></li>
<li><a class="reference internal" href="#example-5">Example 5</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="omhiredis.html"
                        title="previous chapter">omhiredis: Redis Output Module</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="omhttpfs.html"
                        title="next chapter">omhttpfs: Hadoop HTTPFS Output Module</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../../_sources/configuration/modules/omhttp.rst.txt"
           rel="nofollow">Show Source</a></li>
    <li><a href="https://github.com/rsyslog/rsyslog-doc/edit/master/source/configuration/modules/omhttp.rst"
           rel="nofollow">Edit on GitHub</a></li>
  </ul>

<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="omhttpfs.html" title="omhttpfs: Hadoop HTTPFS Output Module"
             >next</a> |</li>
        <li class="right" >
          <a href="omhiredis.html" title="omhiredis: Redis Output Module"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">rsyslog 8.2102.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Configuration</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" >Modules</a> &#187;</li>
          <li class="nav-item nav-item-3"><a href="idx_output.html" >Output Modules</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    </div>
  </body>
</html>